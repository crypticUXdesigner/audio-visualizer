<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Visual Player - Audio Visualizer</title>
    <meta name="description" content="An immersive WebGL audio visualizer with dynamic color palettes and real-time frequency analysis. Experience music in a new way with stunning visual effects synchronized to your favorite tracks.">
    <meta name="keywords" content="audio visualizer, music visualizer, WebGL, shader, audio analysis, frequency visualization">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Visual Player - Audio Visualizer">
    <meta property="og:description" content="An immersive WebGL audio visualizer with dynamic color palettes and real-time frequency analysis.">
    <meta property="og:url" content="https://crypticUXdesigner.github.io/audio-visualizer/">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Visual Player - Audio Visualizer">
    <meta name="twitter:description" content="An immersive WebGL audio visualizer with dynamic color palettes and real-time frequency analysis.">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script>
        // Check for debug mode immediately to prevent flash of buttons
        (function() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('debug')) {
                document.documentElement.classList.add('debug-mode');
            }
        })();
    </script>
</head>
<body>
    <!-- Loading Spinner -->
    <div id="appLoader" class="app-loader">
        <svg class="loader" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <rect class="loader-bar loader-bar-1" x="4" y="11" width="2" height="2" rx="1"/>
            <rect class="loader-bar loader-bar-2" x="11" y="11" width="2" height="2" rx="1"/>
            <rect class="loader-bar loader-bar-3" x="18" y="11" width="2" height="2" rx="1"/>
        </svg>
    </div>
    
    <!-- Background Shader Canvas -->
    <canvas id="backgroundCanvas"></canvas>
    
    <!-- Frequency Band Visualizer -->
    <canvas id="frequencyCanvas"></canvas>
    
    <!-- Audio Controls -->
    <div id="audioControls">
        <!-- File Input (hidden, for custom files) -->
        <input type="file" id="audioFileInput" accept="audio/*" style="display: none;" />
    </div>
    
    <!-- Top Control Buttons -->
    <div class="top-controls ui-hidden">
        <!-- Color Preset Button -->
        <div class="top-control-item">
            <button id="colorPresetBtn" class="top-control-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
                    <path fill="currentColor" d="M20 14c-.092.064-2 2.083-2 3.5c0 1.494.949 2.448 2 2.5c.906.044 2-.891 2-2.5c0-1.5-1.908-3.436-2-3.5M9.586 20c.378.378.88.586 1.414.586s1.036-.208 1.414-.586l7-7l-.707-.707L11 4.586L8.707 2.293L7.293 3.707L9.586 6L4 11.586c-.378.378-.586.88-.586 1.414s.208 1.036.586 1.414zM11 7.414L16.586 13H5.414z"/>
                </svg>
            </button>
            <div id="colorPresetMenu" class="top-control-menu">
                <div id="presetButtons" class="preset-buttons">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
        </div>
        
        <!-- Frequency Visualizer Button -->
        <button id="frequencyVisualizerBtn" class="top-control-btn">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 100 100">
                <path fill="currentColor" d="M46.05 60.163H31.923c-.836 0-1.513.677-1.513 1.513V83.61c0 .836.677 1.513 1.513 1.513H46.05c.836 0 1.512-.677 1.512-1.513V61.675c0-.836-.677-1.512-1.512-1.512m22.027-45.285H53.95c-.836 0-1.513.677-1.513 1.513v67.218c0 .836.677 1.513 1.513 1.513h14.127c.836 0 1.513-.677 1.513-1.513V16.391c0-.836-.677-1.513-1.513-1.513m22.14 20.421H76.09c-.836 0-1.513.677-1.513 1.513v46.797c0 .836.677 1.513 1.513 1.513h14.126c.836 0 1.513-.677 1.513-1.513V36.812c0-.835-.677-1.513-1.512-1.513m-66.307 0H9.783c-.836 0-1.513.677-1.513 1.513v46.797c0 .836.677 1.513 1.513 1.513H23.91c.836 0 1.513-.677 1.513-1.513V36.812c0-.835-.677-1.513-1.513-1.513"/>
            </svg>
        </button>
        
        <!-- Playback Mode Toggle Button (Random/Loop) -->
        <button id="playbackModeBtn" class="top-control-btn" title="Random Playlist">
            <!-- Random Icon (default, visible) -->
            <svg class="random-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
                <path fill="currentColor" d="M10.59 9.17L5.41 4L4 5.41l5.17 5.17l1.42-1.41M14.5 4l2.04 2.04L4 18.59L5.41 20L17.96 7.46L20 9.5V4h-5.5m.33 9.41l-1.41 1.41l3.13 3.13L14.5 20H20v-5.5l-2.04 2.04l-3.13-3.13z"/>
            </svg>
            <!-- Loop Icon (hidden by default) -->
            <svg class="loop-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" style="display: none;">
                <path d="M21.657 6.343a8 8 0 0 1-5.245 13.647L16 20h-6v4l-5-5 5-5v4h6a6 6 0 0 0 4.242-10.242l1.415-1.415ZM19 5l-5 5V6H8a6 6 0 0 0-4.242 10.242l-1.413 1.413A8 8 0 0 1 8 4h6V0l5 5Z"/>
            </svg>
        </button>
    </div>
    
    <!-- FPS Display (Debug Only) -->
    <div id="fpsDisplay" class="fps-display">
        <div class="fps-stat">
            <span class="fps-label">Current:</span>
            <span id="currentFps" class="fps-value">--</span>
        </div>
        <div class="fps-stat">
            <span class="fps-label">Target:</span>
            <span id="targetFps" class="fps-value">30</span>
        </div>
    </div>
    
    <!-- Track Selection Menu (outside controls for independent visibility) -->
    <div id="trackDropdownMenu" class="track-dropdown-menu">
        <!-- Search Input -->
        <div class="track-search-container">
            <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
            </svg>
            <input 
                type="text" 
                id="trackSearchInput" 
                class="track-search-input" 
                placeholder="Search tracks..."
                autocomplete="off"
            />
            <button id="trackSearchClear" class="track-search-clear" style="display: none;">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <!-- Track List -->
        <div id="trackList" class="track-list">
            <!-- Tracks are dynamically loaded from API -->
        </div>
        <!-- No results message -->
        <div id="noResultsMsg" class="no-results-message" style="display: none;">
            No tracks found
        </div>
    </div>
    
    <!-- Audio Controls Container -->
    <div class="audio-controls-container ui-hidden">
        <!-- Track Selection Button -->
        <div id="trackDropdown" class="track-dropdown">
            <button id="trackDropdownBtn" class="track-dropdown-btn">
                <span id="trackDropdownText">Select Track</span>
                <svg class="track-loading-spinner" width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: none;">
                    <circle cx="7" cy="7" r="5.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-dasharray="8 20" opacity="0.7"/>
                </svg>
                <svg class="dropdown-arrow" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4 6L8 10L12 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
        </div>
        
        <!-- Scrubber -->
        <div class="scrubber-container">
            <div class="time-display" style="display: none;">
                <span id="currentTime">0:00</span>
                <span id="totalTime">0:00</span>
            </div>
            <!-- Waveform scrubber will be inserted here by JavaScript -->
        </div>
        
        <!-- Playback Controls -->
        <div class="playback-controls">
            <!-- Skip Left Button -->
            <button id="skipLeftBtn" class="skip-control" title="Previous / Skip to Start">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M6.5 4A1.5 1.5 0 0 1 8 5.5v5.28l9.427-6.6a1 1 0 0 1 1.563.682L19 5v14a1 1 0 0 1-1.573.82L8 13.22v5.28a1.5 1.5 0 0 1-3 0v-13A1.5 1.5 0 0 1 6.5 4Z"/>
                </svg>
            </button>
            
            <!-- Play/Pause Button -->
            <button id="playControlBtn" class="play-control">
                <svg class="play-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M22 12 6 1v22l16-11Z"/>
                </svg>
                <svg class="pause-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" style="display: none;">
                    <path d="M11 22H4V2h7v20Zm9 0h-7V2h7v20Z"/>
                </svg>
            </button>
            
            <!-- Skip Right Button -->
            <button id="skipRightBtn" class="skip-control" title="Next">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M17.5 4A1.5 1.5 0 0 0 16 5.5v5.28l-9.427-6.6a1 1 0 0 0-1.563.682L5 5v14a1 1 0 0 0 1.573.82L16 13.22v5.28a1.5 1.5 0 0 0 3 0v-13A1.5 1.5 0 0 0 17.5 4Z"/>
                </svg>
            </button>
        </div>
    </div>
    
    <script type="module" src="src/main.js"></script>
    <script type="module" src="frequency-visualizer.js"></script>
</body>
</html>

